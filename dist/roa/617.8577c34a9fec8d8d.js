"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[617],{6617:(C,p,s)=>{s.r(p),s.d(p,{LoginModule:()=>Y});var h=s(6895),u=s(7935),d=s(5861),a=s(4006),A=s(5226),c=s.n(A),e=s(6738),i=s(8448),l=s(1155),v=s(2111),L=s(4120),E=s(1188),M=s(8253),T=s(3071),S=s(8611),F=s(6358),_=s(2778),P=s(1272),O=s(676),w=s(2466);function I(r,f){1&r&&(e.TgZ(0,"small",26),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"login.errorMsjEmail")))}function x(r,f){1&r&&(e.TgZ(0,"small",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"login.errorMsjPassword")))}function N(r,f){if(1&r){const t=e.EpF();e.TgZ(0,"div",8)(1,"label",28),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.resendActivationEmail())}),e.ALo(5,"translate"),e.qZA()()}2&r&&(e.xp6(2),e.Oqu(e.lcZ(3,2,"login.isNotActiveAccount")),e.xp6(2),e.Q6J("label",e.lcZ(5,4,"login.isNotActiveAccountButton")))}const y=function(r){return{"ng-dirty":r}},U=function(r,f){return{"pi-eye":r,"pi-eye-slash":f}},j=[{path:"",component:(()=>{class r{constructor(t,n,o,m,g,b,Z,D,R){this.auth=t,this._router=n,this.fb=o,this.languageService=m,this.messageService=g,this.loginService=b,this.storageService=Z,this.breadcrumbService=D,this._userService=R,this.subscribes=[],this.show=!1,this.isNotaccountaActive=!1,this.loginForm=this.fb.group({email:[this.storageService.getCookieItem("userEmail")||null,[a.kI.required,a.kI.pattern("^([a-zA-Z0-9_'-'.]+)@([a-zA-Z0-9_'-'.]+).([a-zA-Z]{2,5})$")]],password:[null,[a.kI.required]],rememberMe:[!!this.storageService.getCookieItem("userEmail")]}),this.add_breadcrumb()}ngOnDestroy(){this.subscribes.forEach(t=>{})}ngOnInit(){this.translate=this.languageService.translate,this.translate.onLangChange.subscribe(t=>{this.msjModal=t.translations.login.modalMsj,this.msjError={severity:"error",summary:t.translations.message.titleError,detail:t.translations.login.errorMesage}})}add_breadcrumb(){var t=this;return(0,d.Z)(function*(){t.breadcrumbService.setItems([{label:"ROA"},{label:yield t.languageService.translate.get("menu.login").toPromise(),routerLink:["/login"]}])})()}get errorEmailRequired(){return this.loginForm.get("email").errors?.required&&this.loginForm.get("email").touched}get errorEmailFormat(){return this.loginForm.get("email").errors?.pattern&&this.loginForm.get("email").touched}get errorPasswordRequired(){return this.loginForm.get("password").errors?.required&&this.loginForm.get("password").touched}onLogin(){var t=this;return(0,d.Z)(function*(){if(t.loadTranslateText(),t.messageService.clear(),t.loginForm.valid){c().fire({allowOutsideClick:!1,icon:"info",text:t.msjModal}),c().showLoading(null);let n={email:t.loginForm.get("email").value,password:t.loginForm.get("password").value},o=yield t.loginService.signIn(n).subscribe(function(){var m=(0,d.Z)(function*(g){if(g.detail)return t.showMessageError(),void c().close();t.storageService.saveCookieItem("data_acc",g.access),t.storageService.saveCookieItem("data_ref",g.refresh),yield t.loginService.validateUser(g.access).then(()=>{t.loginService.user?.roles.includes("teacher")&&t.loginService.characterMenu.emit(!0),t.saveEmail(),c().close()}).catch(b=>{t.messageService.add({severity:"error",summary:"Server Error",detail:b}),t.showMessageError(),c().close()})});return function(g){return m.apply(this,arguments)}}(),m=>{console.log(m),"Account inactive user"==m.error?.detail&&(t.isNotaccountaActive=!0),t.showMessageError(),c().close()});t.subscribes.push(o)}else t.markTouchForm()})()}markTouchForm(){Object.values(this.loginForm.controls).forEach(t=>{t.markAsTouched()})}loadTranslateText(){let t=this.translate.currentLang;"es"===t?(this.msjModal=this.translate.translations.es.login.modalMsj,this.msjError={severity:"error",summary:this.translate.translations.es.message.titleError,detail:this.translate.translations.es.login.errorMesage}):"en"==t&&(this.msjModal=this.translate.translations.en.login.modalMsj,this.msjError={severity:"error",summary:this.translate.translations.en.message.titleError,detail:this.translate.translations.en.login.errorMesage})}showMessageError(){this.messageService.add(this.msjError)}onSaveEmail(t){t.checked?this.saveEmail():this.storageService.removeCookieItem("userEmail")}saveEmail(){null!==this.loginForm.get("email").value&&""!==this.loginForm.get("email").value?this.storageService.saveCookieItem("userEmail",this.loginForm.get("email").value):(this.markTouchForm(),this.loginForm.controls.rememberMe.setValue(!1))}resendActivationEmail(){let t=this.loginForm.get("email")?.value,n=this._userService.set_email_verify_new_token(t).subscribe(o=>{200==o.status?(this.messageService.add("es"===this.translate.currentLang?{severity:"success",summary:this.translate.translations.es.login.isNotActiveAccountMessageSummary,detail:this.translate.translations.es.login.isNotActiveAccountMessage}:{severity:"success",summary:this.translate.translations.en.login.isNotActiveAccountMessageSummary,detail:this.translate.translations.en.login.isNotActiveAccountMessage}),this.isNotaccountaActive=!1):(this.isNotaccountaActive=!1,this._router.navigate(["/"]))},o=>{this.isNotaccountaActive=!1,this._router.navigate(["/"])});this.subscribes.push(n)}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(i.e),e.Y36(u.F0),e.Y36(a.QS),e.Y36(l.T),e.Y36(v.ez),e.Y36(L.r),e.Y36(E.V),e.Y36(M.p),e.Y36(T.K))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["app-login"]],decls:45,vars:46,consts:[[1,"login-body","layout-light"],[1,"login-content","animate__animated","animate__fadeIn"],[1,"login-panel"],[1,"login-panel-content"],[1,"logo"],["loading","lazy","src","/assets/img/nuevoLogoRoa.png",2,"width","100px !important","height","auto !important",3,"alt"],["autocomplete","off","id","loginForm",3,"formGroup","ngSubmit"],[1,"forms"],[1,"p-field","p-fluid"],["for","email"],["aria-describedby","email-help","id","email","pInputText","","type","email","name","email","formControlName","email",3,"ngClass","placeholder"],["id","email-help","class","p-error",4,"ngIf"],["for","password"],[1,"viewPass"],["aria-describedby","pass-help","id","password","name","password","formControlName","password","pPassword","",3,"ngClass","type","placeholder","feedback"],["tabindex","0","aria-label","Ver contrase\xf1a",1,"pi",3,"ngClass","click","keyup.enter"],["id","pass-help","class","p-error",4,"ngIf"],["class","p-field p-fluid",4,"ngIf"],[1,"p-col-12"],["name","checked","id","check","inputId","recordar_contr","formControlName","rememberMe","binary","true",3,"onChange"],["for","recordar_contr"],[1,"buttons"],["pButton","","type","submit",3,"label"],[1,"links"],["href","#/restart-password",1,"secondary-button","first"],["href","#/contact",1,"secondary-button","second"],["id","email-help",1,"p-error"],["id","pass-help",1,"p-error"],["for","messageActive"],["pButton","","type","button",3,"label","click"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"img",5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"h2"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"p-messages"),e.TgZ(11,"form",6),e.NdJ("ngSubmit",function(){return o.onLogin()}),e.TgZ(12,"div",7)(13,"div",8)(14,"label",9),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._UZ(17,"input",10),e.ALo(18,"translate"),e.YNc(19,I,3,3,"small",11),e.qZA(),e.TgZ(20,"div",8)(21,"label",12),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"div",13),e._UZ(25,"input",14),e.ALo(26,"translate"),e.TgZ(27,"i",15),e.NdJ("click",function(){return o.show=!o.show})("keyup.enter",function(){return o.show=!o.show}),e.qZA()(),e.YNc(28,x,3,3,"small",16),e.qZA(),e.YNc(29,N,6,6,"div",17),e.TgZ(30,"div",18)(31,"p-checkbox",19),e.NdJ("onChange",function(g){return o.onSaveEmail(g)}),e.qZA(),e.TgZ(32,"label",20),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"div",21),e._UZ(36,"button",22),e.ALo(37,"translate"),e.TgZ(38,"div",23)(39,"a",24),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"a",25),e._uU(43),e.ALo(44,"translate"),e.qZA()()()()()()()()()),2&n&&(e.xp6(5),e.Q6J("alt",e.lcZ(6,19,"menu.altLogo")),e.xp6(3),e.Oqu(e.lcZ(9,21,"login.loginTitle")),e.xp6(3),e.Q6J("formGroup",o.loginForm),e.xp6(4),e.Oqu(e.lcZ(16,23,"login.labeEmail")),e.xp6(2),e.Q6J("ngClass",e.VKq(39,y,o.errorEmailRequired||o.errorEmailFormat))("placeholder",e.lcZ(18,25,"login.placeholderEmail")),e.xp6(2),e.Q6J("ngIf",o.errorEmailRequired||o.errorEmailFormat),e.xp6(3),e.Oqu(e.lcZ(23,27,"login.labelPassword")),e.xp6(3),e.Q6J("ngClass",e.VKq(41,y,o.errorPasswordRequired))("type",o.show?"text":"password")("placeholder",e.lcZ(26,29,"login.placeholderPass"))("feedback",!1),e.xp6(2),e.Q6J("ngClass",e.WLB(43,U,!o.show,o.show)),e.xp6(1),e.Q6J("ngIf",o.errorPasswordRequired),e.xp6(1),e.Q6J("ngIf",1==o.isNotaccountaActive),e.xp6(4),e.hij("\xa0 ",e.lcZ(34,31,"login.check"),""),e.xp6(3),e.Q6J("label",e.lcZ(37,33,"login.btnLogin")),e.xp6(4),e.hij("",e.lcZ(41,35,"login.recoverPassword")," "),e.xp6(3),e.hij("",e.lcZ(44,37,"login.messageProblemLogin")," "))},dependencies:[h.mk,h.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,S.Hq,F.XZ,_.o,P.V,O.r,w.X$],styles:[".login-content[_ngcontent-%COMP%]{position:relative;height:70vh}.login-content[_ngcontent-%COMP%]   .desert[_ngcontent-%COMP%]{position:absolute;bottom:0}.login-content[_ngcontent-%COMP%]   .login-panel[_ngcontent-%COMP%]{height:100%}.viewPass[_ngcontent-%COMP%]{position:relative}.viewPass[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;top:8px;right:10px;padding:5px;cursor:pointer}.links[_ngcontent-%COMP%]{display:grid}.links[_ngcontent-%COMP%]   .first[_ngcontent-%COMP%]{text-align:right}"]})}return r})(),data:{breadcrumb:null}}];let k=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=e.oAB({type:r});static#s=this.\u0275inj=e.cJS({imports:[u.Bz.forChild(j),u.Bz]})}return r})();var J=s(380);let Y=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=e.oAB({type:r});static#s=this.\u0275inj=e.cJS({imports:[h.ez,k,a.UX,J.m]})}return r})()},3071:(C,p,s)=>{s.d(p,{K:()=>A});var h=s(2340),u=s(6738),d=s(529);const a=h.N.baseUrl;let A=(()=>{class c{constructor(i){this.http=i}getUserDetail(i){return this.http.get(`${a}/user-management/${i}`)}updateUser(i){return this.http.put(`${a}/user-management/${i.id}/`,i)}updateImage(i,l){let v=new FormData;return v.append("image",i),this.http.put(`${a}/user/photo/${l}/`,v)}sent_email_token_verify(i,l){return this.http.get(`${a}/email-verify/`+i+"/"+l)}set_email_verify_new_token(i){return this.http.post(`${a}/set-verify/`,{email:i})}sendContactEmail(i){let l=new FormData;return l.append("name",i.name),l.append("email",i.email),l.append("content",i.message),this.http.post(`${a}/contact-email/`,l)}static#e=this.\u0275fac=function(l){return new(l||c)(u.LFG(d.eN))};static#t=this.\u0275prov=u.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()}}]);